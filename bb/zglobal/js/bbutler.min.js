/** 
 * @overview bbutler.js
 * @copyright Jacob Chapman 2013-2014
 * 
 * @license This program is free software: you can redistribute it and/or 
 * modify it under the terms of the GNU General Public License as published 
 * by the Free Software Foundation version 3 of the License. This program is
 * distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
 * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
 * PARTICULAR PURPOSE.
 */
var buildButler=function(e,t,n){"use strict";return e.Helpers=function(){var e={};return e.toggleClass=function(e,t){if(e.classList)e.classList.toggle(t);else{var n=e.className.split(" "),i=n.indexOf(t);i>=0?n.splice(i,1):n.push(t),e.className=n.join(" ")}},e.addClass=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},e.removeClass=function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},e.hasClass=function(e,t){e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)},e.getXml=function(e,t,n){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="document",i.overrideMimeType(t),i.onload=function(){i.status>=200&&i.status<400?n(i.responseXML):console.log("oops")},i.onerror=function(){console.log("There was a connection error of some sort")},i.send()},e.createApplicationEvent=function(e,i){if(t.CustomEvent)var r=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:i});else{var r=n.createEvent("CustomEvent");r.initCustomEvent(e,!0,!0,i)}return r},e.contains=function(e,t){return e.indexOf(t)>=0},e.isSvgShape=function(e){return e instanceof SVGPathElement||e instanceof SVGRectElement||e instanceof SVGCircleElement||e instanceof SVGEllipseElement||e instanceof SVGLineElement||e instanceof SVGPolylineElement||e instanceof SVGPolygonElement},e}(),e.Schematic=function(e,t){var i,r,a,s=n.querySelector("#build"),l="http://www.w3.org/2000/svg",c="http://www.w3.org/1999/xlink",o=function(){function i(e){var t=e.createSVGRect();return t.width=parseFloat(e.getAttribute("width")),t.height=parseFloat(e.getAttribute("height")),t}function o(e,t){var i=n.createElementNS(l,"image");return i.setAttributeNS(c,"href",t),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("width",e.width),i.setAttribute("height",e.height),i}function u(e){var t=o(i(e),"base.svg");return e.insertBefore(t,e.firstChild),s.appendChild(e)}function d(){}function f(e){e.addEventListener("click",function(e){var n=e.target;if(t.isSvgShape(n)){var i=t.createApplicationEvent("buildbutler.partclicked",{partId:n.id});n.dispatchEvent(i)}},!1),n.addEventListener("buildbutler.partclicked",function(e){p(e.detail.partId)},!1)}function v(t){a=e(t)}var m=function(e,i){t.getXml(e,"image/svg+xml",function(e){var t=n.importNode(e.documentElement,!0);i(t)})};m("build.svg",function(e){var n=u(e);d(n),f(n),v(n),r=n;var i=t.createApplicationEvent("buildbutler.schematicassembled");n.dispatchEvent(i)})},u=function(e){if(null!=e&&e!==i){d()&&t.removeClass(i,"selectedpart"),t.addClass(e,"selectedpart"),i=e;var n=t.createApplicationEvent("buildbutler.partselected");e.dispatchEvent(n)}},d=function(){return null!=i},p=function(e){var t=r.getElementById(e);u(t)},f=function(){a.resetZoom(),a.center()};return{assemble:o,getSelectedPartId:function(){return i?i.id:""},title:function(){return s},reset:f,selectPartById:p}}(svgPanZoom,e.Helpers),e.PartList=function(e){var i=n.querySelector("#search"),r=n.querySelector(".partlist"),a=n.createDocumentFragment(),s=function(e){return 0===e.indexOf("_")?e.substring(1):e},l=function(e,t){var n=function(e,t){for(var i=e.lastChild;i;i=i.previousSibling)n(i,t);t(e)};n(e,t)},c=function(i){function r(e){var t=n.createElement("ol");return t.setAttribute("class",e),t}function l(e){var i=n.createElement("a");return i.textContent=s(e),i.href=t.location.href+"#"+e,i}function c(e,t){var i=r("category "+t),a=i.appendChild(n.createElement("li")),s=n.createElement("span");s.className="name",s.textContent=t,a.appendChild(s);var l=r("parts");return a.appendChild(l),e.appendChild(i),l}if(i.id&&e.isSvgShape(i)){var o=n.createElement("li"),u=l(i.id);if(o.appendChild(u),i.parentNode.id&&i.parentNode instanceof SVGGElement){var d=i.parentNode.id,p="."+d+" ol.parts",f=a.querySelector(p);null==f&&(f=c(a,d)),f.appendChild(o)}else{var v=a.querySelector("ol.uncategorized");if(null==v){var m=r("uncategorized");a.appendChild(m),v=m}m.appendChild(o)}}}(function(){n.addEventListener("buildbutler.schematicassembled",function(t){var n=t.target;l(n,c),r.appendChild(a);var i=e.createApplicationEvent("buildbutler.partlistloaded");r.dispatchEvent(i)}),n.addEventListener("buildbutler.partselected",function(t){var n=r.querySelector(".selectedpart"),i=r.querySelector('a[href$="'+t.target.id+'"]').parentNode;n!==i&&(n&&e.removeClass(n,"selectedpart"),e.addClass(i,"selectedpart"))}),r.addEventListener("click",function(t){var n=t.target;if(n instanceof HTMLAnchorElement){var i=n.hash.substring(1);t.preventDefault();var r=e.createApplicationEvent("buildbutler.partclicked",{partId:i});n.dispatchEvent(r)}}),i.addEventListener("keyup",function(){})})(),o=function(){};return{filter:function(){},clearFilter:o}}(e.Helpers),e.Main=function(e,i,r){var a=function(){var e=n.querySelector("#invert");e.addEventListener("click",function(){r.toggleClass(n.documentElement,"inverted")})},s=function(){var n=t.location.hash;if(n){var i=n.substring(1);e.selectPartById(i)}},l=function(){e.assemble(),a(),n.addEventListener("buildbutler.partlistloaded",s)};return{init:l}}(e.Schematic,e.PartList,e.Helpers),n.addEventListener("DOMContentLoaded",e.Main.init),e}(buildButler||{},window,document);