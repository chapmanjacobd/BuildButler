/*
 Chris Chapman, Jacob Chapman 2013-2014
 @url       http://buildbutler.org/
 @version   1.1101
 Licensed under the Eiffel Forum License 2.
*/
var buildButler=function(e,d,u,x,h){h.Helpers=function(){var a={toggleClass:function(c,a){if(c.classList)c.classList.toggle(a);else{var f=c.className.split(" "),b=f.indexOf(a);0<=b?f.splice(b,1):f.push(a);c.className=f.join(" ")}},addClass:function(c,a){c.classList?c.classList.add(a):c.className+=" "+a},removeClass:function(c,a){c.classList?c.classList.remove(a):c.className=c.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+"(\\b|$)","gi")," ")},hasClass:function(c,a){return c.classList?
c.classList.contains(a):(new RegExp("(^| )"+a+"( |$)","gi")).test(c.className)},showElement:function(c){a.removeClass(c,"hidden")},hideElement:function(c){a.addClass(c,"hidden")},isHidden:function(c){return a.hasClass(c,"hidden")},toggleHidden:function(c){a.toggleClass(c,"hidden")}},b=function(c,a,b){var d=new XMLHttpRequest;d.open("GET",c,!0);d.responseType="document";d.overrideMimeType(a);d.onload=function(){200<=d.status&&400>d.status?b(d.responseXML):console.log("Whoops")};d.onerror=function(){console.log("There was a connection error of some sort")};
d.send()};a.importSvgNode=function(c,a){b(c,"image/svg+xml",function(c){c=d.importNode(c.documentElement,!0);a(c)})};a.createApplicationEvent=function(c,a){var b;e.CustomEvent?b=new CustomEvent(c,{bubbles:!0,cancelable:!0,detail:a}):(b=d.createEvent("CustomEvent"),b.initCustomEvent(c,!0,!0,a));return b};a.contains=function(c,a){return-1!==c.toLowerCase().indexOf(a.toLowerCase())};a.closest=function(c,a){for(;c;){if(a(c))return c;c=c.parentNode}return!1};a.merge=function(c,b){c=c||{};[].slice.call(arguments,
1).forEach(function(a){for(var b in a)a.hasOwnProperty(b)&&(c[b]="object"===typeof a[b]?this.merge(c[b],a[b]):a[b])},a);return c};a.isSvgShape=function(a){return a instanceof SVGPathElement||a instanceof SVGRectElement||a instanceof SVGCircleElement||a instanceof SVGEllipseElement||a instanceof SVGLineElement||a instanceof SVGPolylineElement||a instanceof SVGPolygonElement};a.isElectronicComponent=function(a){return a&&a.id&&"_"===a.id.charAt(0)};a.moveIntoView=function(a,b){var d=a.offsetParent,
g=a.getBoundingClientRect(),d=d.getBoundingClientRect();g.bottom<=d.bottom&&g.top>=d.top||b(a)};a.supercss=function(a,b,f){for(var g=0;g<d.styleSheets.length;g++)try{d.styleSheets[g].insertRule(a+" {"+b+":"+f+"}",d.styleSheets[g].cssRules.length)}catch(e){try{d.styleSheets[g].addRule(a,b+":"+f)}catch(l){}}};a.scrollIntoView=function(c){var b=c.offsetParent,d=c.offsetTop-(b.clientHeight-c.offsetHeight)/2,g=function(c){a.moveIntoView(c,function(){b.scrollTop=d})},h=function(c){var g=b.scrollTop,h=d-
g,k,m,t,p,s=function(a){k=Math.abs(a-p);m=k/750;m=1<m?1:m;t=g+h*m*(2-m);b.scrollTop=Math.floor(t);a=b.scrollTop;t!=d&&a!=d&&b.scrollHeight-a!==b.clientHeight&&e.requestAnimationFrame(s)};a.moveIntoView(c,function(){p=e.performance.now();e.requestAnimationFrame(s)})};e.requestAnimationFrame&&e.performance.now?h(c):g(c)};return a}();h.Schematic=function(a,b){var c=d.getElementById("build"),e,f,g,h=function(a){a&&(a=e.getElementById(a),null!=a&&a!==g&&(null!=g&&b.removeClass(g,"selectedcomponent"),b.addClass(a,
"selectedcomponent"),g=a,a=b.createApplicationEvent("buildbutler.componentselected",{componentId:g.id}),g.dispatchEvent(a)))},l=d.getElementById("monotonecolor"),n=d.getElementById("strokecolor"),q=d.getElementById("togglelist"),k=function(){b.supercss('svg [id^="_"]',"fill",l.value);q.style.color=l.value},m=function(){b.supercss('svg [id^="_"]',"fill","");l.value="#e1e1e1";q.style.color="darkgreen"};n.addEventListener("change",function(){b.supercss(".selectedcomponent","stroke",n.value);b.supercss("ol .selectedcomponent a",
"background-color",n.value)},!1);l.addEventListener("change",k,!1);return{assemble:function(k){var g=function(a){var b=a.createSVGRect();b.width=parseFloat(a.getAttribute("width"));b.height=parseFloat(a.getAttribute("height"));return b},m=function(a,b){var c=d.createElementNS("http://www.w3.org/2000/svg","image");c.setAttributeNS("http://www.w3.org/1999/xlink","href",b);c.setAttribute("x",0);c.setAttribute("y",0);c.setAttribute("width",a.width);c.setAttribute("height",a.height);return c},l=function(a){var c=
function(a){a.preventDefault();if(a=b.closest(a.target,b.isElectronicComponent)){var c=b.createApplicationEvent("buildbutler.componentclicked",{componentId:a.id});a.dispatchEvent(c)}};a.addEventListener("click",c,!1);a.addEventListener("touchstart",c,!1);d.addEventListener("buildbutler.componentclicked",function(a){h(a.detail.componentId)},!1);a.addEventListener("buildbutler.schematicloaded",function(){var a=d.getElementById("loading");b.addClass(a,"disabled")},!1)},n=function(d,k){var r=m(g(d),k.basePath);
r.addEventListener("load",function(a){a=b.createApplicationEvent("buildbutler.schematicloaded",{schematic:d});r.dispatchEvent(a)});d.insertBefore(r,d.firstChild);e=c.appendChild(d);l(e);f=a(e,k.svgPanZoomOptions);var h=b.createApplicationEvent("buildbutler.schematicassembled",{schematic:e});e.dispatchEvent(h)};k=b.merge({},{buildPath:"build.svg",basePath:"base.png",svgPanZoomOptions:{zoomScaleSensitivity:.1,maxZoom:4,minZoom:.4}},k);b.importSvgNode(k.buildPath,function(a){n(a,k)})},reset:function(){f.resetZoom();
f.center();b.removeClass(d.documentElement,"inverted");b.removeClass(c,"showall");m();b.supercss(".selectedcomponent","stroke","");b.supercss("ol .selectedcomponent a","background-color","");n.value="#e1e1e1"},toggleShowAll:function(){b.toggleClass(c,"showall")},toggleMonotoneMode:function(){(l.value=q.style.color)?m():k()},selectComponentById:h,slow3DMode:function(){b.supercss("#Parts","-webkit-filter","drop-shadow( 0px 2px 2px #777 )");b.supercss("#Parts","filter","drop-shadow( 0px 2px 2px #777 )")},
disableDoubleClickZoom:function(){f.disableDblClickZoom()},panBy:function(a){f.panBy(a)},panUp:function(){f.panBy({x:0,y:50})},panDown:function(){f.panBy({x:0,y:-50})},panLeft:function(){f.panBy({x:50,y:0})},panRight:function(){f.panBy({x:-50,y:0})},panUpFast:function(){f.panBy({x:0,y:175})},panDownFast:function(){f.panBy({x:0,y:-175})},panLeftFast:function(){f.panBy({x:175,y:0})},panRightFast:function(){f.panBy({x:-175,y:0})},zoomIn:function(){f.zoomIn()},zoomOut:function(){f.zoomOut()},zoomInFast:function(){f.zoomBy(2)},
zoomOutFast:function(){f.zoomBy(.5)}}}(u,h.Helpers);h.ComponentPanel=function(a){var b=d.getElementById("filter"),c=d.getElementById("componentlist"),h=d.getElementById("componentlistpanel"),f=d.getElementById("selectedcomponent"),g=d.getElementById("top"),p=d.getElementById("togglelist"),l,n;d.addEventListener("click",function(a){a.target!==b&&b.blur()});var q=e.matchMedia("(max-width: 767px)").matches,k=function(a){var b=c.querySelector(".selectedcomponent");if(b){var b=b.querySelector("a.component"),
d=l.indexOf(b);a=l[a(d)]||b;b=new MouseEvent("click",{view:e,bubbles:!0,cancelable:!1});a.dispatchEvent(b)}},m=k.bind(void 0,function(a){return--a}),k=k.bind(void 0,function(a){return++a}),t=function(a){return 0===a.indexOf("_")?a.substring(1).replace(/_/g,"\u00a0"):a},u=function(b){return a.closest(b,function(b){return a.hasClass(b,"category")})},s=function(){a.toggleHidden(h);a.toggleClass(p,"rotatopotato")},v=function(b){var c=a.hideElement,d=a.showElement,k=function(a){d(a.parentNode)},f=function(a){c(a.parentNode)},
e=function(b){return a.isHidden(b.parentNode)},g=function(b){(a.contains(b.firstChild.textContent,this)?k:f).call(null,b)};b=b?b.trim().replace(/\s+/g,"\u00a0"):"";l.forEach(b?g:k,b);n.forEach(function(a){([].slice.call(a.getElementsByClassName("component")).every(e)?c:d).call(null,a)})},w=function(){b.value="";v("")};(function(){var b=function(b,c){var k=function(a){var b=[].slice.call(arguments),c=d.createElement("ol");c.setAttribute("class",b.join(" "));return c},f=function(b){var c=d.createElement("a");
c.textContent=t(b);c.className="component";c.href="#"+b;c.addEventListener("click",function(c){c.preventDefault();var d=a.createApplicationEvent("buildbutler.componentclicked",{componentId:b});c.currentTarget.dispatchEvent(d)},!1);return c},e=function(a){var b=d.createElement("span");b.className="quantity";b.textContent=a;return b},g=function(b){var c=function(a){return a instanceof SVGPathSegMovetoAbs||a instanceof SVGPathSegMovetoRel};return b instanceof SVGPathElement?[].filter.call(b.pathSegList,
c).length:b instanceof SVGGElement&&b.hasChildNodes()?[].reduce.call(b.childNodes,function(a,b){return a+g(b)},0):a.isSvgShape(b)?1:0},h=function(a){return a&&a.id&&"_"!==a.id.charAt(0)&&a instanceof SVGGElement},m=function(b){if(a.hasClass(b,"category"))return b.querySelector("ol.components");throw"Must be a category to get the component list!";},l=function(b,c){var f=c.id,e=b.querySelector("ol."+f);if(null===e){var e=k("category",f),g=d.createElement("li");e.appendChild(g);var r=d.createElement("span");
r.className="name";r.textContent=f;g.appendChild(r);f=k("components");g.appendChild(f);e=b.appendChild(e);c&&h(c.parentNode)&&(f=l(b,c.parentNode),f=m(f),a.addClass(e,"subcategory"),g=d.createElement("li"),g.appendChild(e),f.appendChild(g))}return e},n=function(a,b){var c=b&&h(b.parentNode);return a.querySelector(c?"."+b.parentNode.id:"ol.uncategorized")||c?m(l(a,b.parentNode)):a.insertBefore(k("uncategorized"),a.firstChild)};if(a.isElectronicComponent(c)){var f=f(c.id),p=g(c);1<p&&(e=e(p),f.appendChild(e));
e=d.createElement("li");e.appendChild(f);n(b,c).appendChild(e)}},k=function(a,b){var c=function(a,b){for(var d=a.lastChild;d;d=d.previousSibling)c(d,b);b(a)};c(a,b)};d.addEventListener("buildbutler.schematicassembled",function(f){var e=d.createDocumentFragment();k(f.detail.schematic,function(a){b(e,a)});c.appendChild(e);f=a.createApplicationEvent("buildbutler.componentlistloaded");c.dispatchEvent(f)})})();(function(){d.addEventListener("buildbutler.componentselected",function(b){var d=c.querySelector(".selectedcomponent"),
e=c.querySelector('a[href$="#'+b.detail.componentId+'"]');b=e.parentNode;d&&a.removeClass(d,"selectedcomponent");a.addClass(b,"selectedcomponent");d=[];d.push(e.firstChild.textContent);var k=u(e);a.hasClass(k,"subcategory")&&d.push(k.querySelector("span.name").textContent);e=e.querySelector("span.quantity");d.push("("+(e?e.textContent:"1")+"\u00d7)");f.textContent=d.join("\u00a0");a.isHidden(b)||a.scrollIntoView(b)},!1)})();(function(){p.addEventListener("click",s,!1);g.addEventListener("click",function(){q&&
s()},!1);d.addEventListener("buildbutler.componentselected",function(){q&&(a.hideElement(h),a.addClass(p,"rotatopotato"))},!1)})();(function(){d.addEventListener("buildbutler.componentlistloaded",function(){l=[].slice.call(c.getElementsByClassName("component"));n=[].slice.call(c.getElementsByClassName("category"));b.addEventListener("input",function(a){v(a.target.value)},!1)},!1)})();return{filter:v,clearFilter:w,isSmallScreen:q,toggleComponentList:s,showComponentList:function(){a.showElement(h);
a.removeClass(p,"rotatopotato");w();b.focus()},selectPrevious:m,selectNext:k}}(h.Helpers);h.Main=function(a,b,c,h){var f=function(){h.toggleClass(d.documentElement,"inverted")},g=function(){var a=d.getElementById("reset");d.addEventListener("buildbutler.schematicassembled",function(){a.addEventListener("click",b.reset,!1)},!1)},p=function(){d.addEventListener("buildbutler.componentlistloaded",function(){var a=e.history&&e.history.state?e.history.state.componentId:e.location.hash.substring(1);b.selectComponentById(a)},
!1)},l=function(){d.addEventListener("buildbutler.componentselected",function(a){a=a.detail.componentId;var b="#"+a;b!==e.location.hash&&(e.history&&e.history.pushState?e.history.pushState({componentId:a},a,b):e.location.hash=b)},!1)},n=function(){e.addEventListener("popstate",function(a){a=a.state&&a.state.componentId?a.state.componentId:e.location.hash.substring(1);b.selectComponentById(a)})},q=function(){d.addEventListener("buildbutler.componentlistloaded",function(){a.add("W",b.panUp,{propagate:!0});
a.add("A",b.panLeft,{propagate:!0});a.add("S",b.panDown,{propagate:!0});a.add("D",b.panRight,{propagate:!0});a.add("SHIFT+W",b.panUpFast,{propagate:!0});a.add("SHIFT+A",b.panLeftFast,{propagate:!0});a.add("SHIFT+S",b.panDownFast,{propagate:!0});a.add("SHIFT+D",b.panRightFast,{propagate:!0});a.add("E",b.zoomIn,{propagate:!0});a.add("=",b.zoomIn,{propagate:!0});a.add("Q",b.zoomOut,{propagate:!0});a.add("-",b.zoomOut,{propagate:!0});a.add("SHIFT+E",b.zoomInFast);a.add("SHIFT+Q",b.zoomOutFast);a.add("R",
b.reset);a.add("H",c.toggleComponentList);a.add("F",c.showComponentList,{type:"keyup"});a.add("SHIFT+3",b.slow3DMode);a.add("U",b.toggleMonotoneMode);a.add("I",f);a.add("O",b.toggleShowAll);a.add("T",c.selectPrevious);a.add("K",c.selectPrevious);a.add("Up",c.selectPrevious);a.add("G",c.selectNext);a.add("J",c.selectNext);a.add("Down",c.selectNext)},!1)};return{init:function(a){b.assemble(a);d.getElementById("invert").addEventListener("click",f,!1);g();d.getElementById("showallbtn").addEventListener("click",
b.toggleShowAll,!1);p();l();n();h.isSmallScreen&&hideComponentList();q()}}}(x,h.Schematic,h.ComponentPanel,h.Helpers);h.init=h.Main.init;return h}(window,document,svgPanZoom,shortcut,buildButler||{});
